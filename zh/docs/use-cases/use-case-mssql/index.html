<!doctype html>
<html lang="zh" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-use-cases/use-case-mssql" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.4.0">
<title data-rh="true">MSSQL → Azure Blob | OIBus - Data collection solution</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://oibus.optimistik.com/zh/docs/use-cases/use-case-mssql"><meta data-rh="true" property="og:locale" content="zh"><meta data-rh="true" property="og:locale:alternate" content="en"><meta data-rh="true" name="docusaurus_locale" content="zh"><meta data-rh="true" name="docsearch:language" content="zh"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="MSSQL → Azure Blob | OIBus - Data collection solution"><meta data-rh="true" name="description" content="Beforehand"><meta data-rh="true" property="og:description" content="Beforehand"><link data-rh="true" rel="icon" href="/zh/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://oibus.optimistik.com/zh/docs/use-cases/use-case-mssql"><link data-rh="true" rel="alternate" href="https://oibus.optimistik.com/docs/use-cases/use-case-mssql" hreflang="en"><link data-rh="true" rel="alternate" href="https://oibus.optimistik.com/zh/docs/use-cases/use-case-mssql" hreflang="zh"><link data-rh="true" rel="alternate" href="https://oibus.optimistik.com/docs/use-cases/use-case-mssql" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://RFGM4OD43Y-dsn.algolia.net" crossorigin="anonymous"><link rel="search" type="application/opensearchdescription+xml" title="OIBus - Data collection solution" href="/zh/opensearch.xml"><link rel="stylesheet" href="/zh/assets/css/styles.7bd87aaf.css">
<script src="/zh/assets/js/runtime~main.edc8bdfc.js" defer="defer"></script>
<script src="/zh/assets/js/main.6613f582.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/zh/"><div class="navbar__logo"><img src="/zh/img/logo.svg" alt="OIBus Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/zh/img/logo.svg" alt="OIBus Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">OIBus</b></a><a class="navbar__item navbar__link" href="/zh/docs/guide/">文件</a><a class="navbar__item navbar__link" href="/zh/docs/developer/">开发人员</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/zh/docs/use-cases/">使用案例</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/zh/docs/guide/">v3</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/zh/docs/use-cases/use-case-mssql">v3</a></li><li><a class="dropdown__link" href="/zh/docs/v2/guide/">v2</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link" href="/zh/docs/use-cases/use-case-mssql"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>中文</a><ul class="dropdown__menu"><li><a href="/docs/use-cases/use-case-mssql" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="en">English</a></li><li><a href="/zh/docs/use-cases/use-case-mssql" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="zh">中文</a></li></ul></div><a href="https://github.com/OptimistikSAS/OIBus" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="搜索"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">搜索</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="文档侧边栏" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/zh/docs/use-cases/">Use cases main page</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/zh/docs/use-cases/use-case-opcua">使用OIAnalytics的OPCUA</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/zh/docs/use-cases/use-case-mssql">MSSQL → Azure Blob</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/zh/docs/use-cases/use-case-ads">TwinCAT ADS → OIAnalytics</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/zh/docs/use-cases/use-case-modbus">Modbus → File Writer</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/zh/docs/use-cases/use-case-ip21">IP21 → AWS S3</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/zh/docs/use-cases/use-case-pi">OSIsoftPI → OIAnalytics</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/zh/docs/use-cases/use-case-advanced">Advanced use case</a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/zh/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">MSSQL → Azure Blob</span><meta itemprop="position" content="1"></li></ul></nav><span class="theme-doc-version-badge badge badge--secondary">版本：v3</span><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><h1>MSSQL → Azure Blob</h1>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="beforehand">Beforehand<a class="hash-link" aria-label="Beforehand的直接链接" title="Beforehand的直接链接" href="/zh/docs/use-cases/use-case-mssql#beforehand">​</a></h2>
<p>This use case shows how to set up an SQL connector (here with MSSQL), particularly working on SQL queries with some tuning
and how to send the resulting CSV files into Azure Blob.</p>
<p>Details regarding the configurations can be located on the <a href="/zh/docs/guide/north-connectors/azure-blob">North Azure Blob</a> and <a href="/zh/docs/guide/south-connectors/mssql">South MSSQL</a> connectors pages.</p>
<p>This specific scenario is constructed around the depicted fictional network.</p>
<div style="display:flex;justify-content:center;margin-bottom:2rem"><div><p><img decoding="async" loading="lazy" alt="MSSQL -&amp;gt; Azure Blob use case" src="/zh/assets/images/mssql-azure-blob-a3fd0ad86722ad197051ae88cb1f1c6e.svg" width="804" height="617" class="img_ev3q"></p></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="south-mssql">South MSSQL<a class="hash-link" aria-label="South MSSQL的直接链接" title="South MSSQL的直接链接" href="/zh/docs/use-cases/use-case-mssql#south-mssql">​</a></h2>
<p>Make sure you have the URL or IP address of the MSSQL server, along with its associated port, and a read-only user.</p>
<div class="theme-admonition theme-admonition-caution admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>Read only user</div><div class="admonitionContent_BuS1"><p>While a read-only user is not mandatory, it is strongly recommended to prevent the insertion or update of data through
a SQL query. South connectors are designed for accessing data, not for creating new entries.</p></div></div>
<p>With the proposed schema, the following settings can be set:</p>
<ul>
<li>Host: <code>10.0.0.1</code></li>
<li>Port: <code>1433</code></li>
<li>Database: <code>oibus-test</code></li>
</ul>
<div style="display:flex;justify-content:center;margin-bottom:2rem"><div><p><img decoding="async" loading="lazy" alt="OPCUA settings" src="/zh/assets/images/mssql-settings-cc59db796cd6fc0d158b012ccb62a75f.png" width="1914" height="572" class="img_ev3q"></p></div></div>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>Testing connection</div><div class="admonitionContent_BuS1"><p>You can verify the connection by testing the settings using the <code>Test settings</code> button.</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="sql-queries">SQL Queries<a class="hash-link" aria-label="SQL Queries的直接链接" title="SQL Queries的直接链接" href="/zh/docs/use-cases/use-case-mssql#sql-queries">​</a></h3>
<p>OIBus provides query variables such as <code>@StartTime</code> and <code>@EndTime</code>. However, their usage is not mandatory.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="without-variable">Without variable<a class="hash-link" aria-label="Without variable的直接链接" title="Without variable的直接链接" href="/zh/docs/use-cases/use-case-mssql#without-variable">​</a></h4>
<p>In this example, a moving window interval can regularly retrieve the data without the need for such variables, between
now and yesterday:</p>
<div class="language-SQL language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> data_name </span><span class="token keyword" style="color:#00009f">AS</span><span class="token plain"> dataName</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">value</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">timestamp</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">table</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">WHERE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">timestamp</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> DATEADD</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">DAY</span><span class="token punctuation" style="color:#393A34">,</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">GETDATE</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">AND</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">timestamp</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> GETDATE</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="theme-admonition theme-admonition-caution admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>DateTime type</div><div class="admonitionContent_BuS1"><p>Ensure that you compare the date with a field of the same date type, such as a DateTime type. Use a
<a href="https://learn.microsoft.com/en-us/sql/t-sql/functions/cast-and-convert-transact-sql?view=sql-server-ver16" target="_blank" rel="noopener noreferrer">cast or convert function</a> to appropriately handle the field or your comparison date.</p></div></div>
<p>In this scenario, the datetime fields section can still be employed to parse dates and output them in the appropriate format.
Only the <code>timestamp</code> is a date time field, and we do not use it as a reference because it is not utilized with <code>@StartTime</code> or
<code>@EndTime</code>.</p>
<div style="display:flex;justify-content:center;margin-bottom:2rem"><div><p><img decoding="async" loading="lazy" alt="MSSQL item without variable" src="/zh/assets/images/mssql-item-1-a296c4a4cd7edd27087e871e47b70f1f.png" width="2280" height="1202" class="img_ev3q"></p></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="with-variables">With variables<a class="hash-link" aria-label="With variables的直接链接" title="With variables的直接链接" href="/zh/docs/use-cases/use-case-mssql#with-variables">​</a></h4>
<p>The <code>@StartTime</code> variable captures the last maximum instant retrieved from a previous query. By default, for the initial
query, it takes the current time minus one hour. The <code>@EndTime</code> variable is replaced by the current time.</p>
<p>To prevent overloading the server with a large query, you can divide the [<code>@StartTime</code>, <code>@EndTime</code>] interval into
smaller chunks. This can be configured in the <strong>History settings</strong> section, from the connector settings:</p>
<ul>
<li>Max read interval (in seconds): If set to 60 seconds, and the interval is 1 hour, 60 sub-interval queries will be generated.</li>
<li>Read delay (in milliseconds) between each sub-interval query.</li>
<li>Overlap (in milliseconds) deduced a number of milliseconds from the <code>@StartTime</code> of the interval that will be chunked,
expanding the query interval while still allowing the retrieval of data before the last maximum instant retrieved.</li>
</ul>
<div style="display:flex;justify-content:center;margin-bottom:2rem"><div><p><img decoding="async" loading="lazy" alt="MSSQL history settings" src="/zh/assets/images/mssql-history-settings-e128ddfed1bd10492d3865301af71c68.png" width="1914" height="190" class="img_ev3q"></p></div></div>
<div class="theme-admonition theme-admonition-caution admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>When to use overlap?</div><div class="admonitionContent_BuS1"><p>Overlap proves beneficial when certain retrieved data exhibit latency and are stored after the query has been executed.
In such cases, it allows for a slight extension of the requested interval.</p><p>Exercise caution if your query involves aggregation, as it might alter your data by shifting the time origin of the first
interval.</p></div></div>
<div class="language-SQL language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">timestamp</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> message</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">level</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> logs </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">WHERE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">timestamp</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">@StartTime</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">AND</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">timestamp</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">@EndTime</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="date-time-fields">Date time fields<a class="hash-link" aria-label="Date time fields的直接链接" title="Date time fields的直接链接" href="/zh/docs/use-cases/use-case-mssql#date-time-fields">​</a></h5>
<p>One date time field can be added:</p>
<ul>
<li>Field name: timestamp</li>
<li>Reference field: true</li>
<li>Type: ISO 8601</li>
</ul>
<p>The <code>timestamp</code> field contains a date-time in ISO-8601 format. It serves as a reference, implying that it will be
stored in the maximum instant of the South cache.</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="serialization">Serialization<a class="hash-link" aria-label="Serialization的直接链接" title="Serialization的直接链接" href="/zh/docs/use-cases/use-case-mssql#serialization">​</a></h5>
<ul>
<li>Type: <code>csv</code></li>
<li>Filename: <code>sqlite-@CurrentDate.csv</code></li>
<li>Output date time format: <code>yyyy-MM-dd&#x27;T&#x27;HH:mm:ss.SSS&#x27;Z&#x27;</code></li>
<li>Output timezone: <code>Europe/Paris</code></li>
<li>Delimiter: <code>Comma ,</code></li>
</ul>
<div style="display:flex;justify-content:center;margin-bottom:2rem"><div><p><img decoding="async" loading="lazy" alt="MSSQL item with variable" src="/zh/assets/images/mssql-item-2-b696aff0e1e0ac36ad4ff539d7ac5165.png" width="2280" height="1202" class="img_ev3q"></p></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="result">Result<a class="hash-link" aria-label="Result的直接链接" title="Result的直接链接" href="/zh/docs/use-cases/use-case-mssql#result">​</a></h5>
<p>Note that the filename with <code>@CurrentDate</code> will always be formatted <code>yyyy_MM_dd_HH_mm_ss_SSS</code>.</p>
<div class="language-csv codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">CSV file sqlite-2024_01_23_10_38_50_063.csv</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csv codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">timestamp;message;level</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2024-01-23T11:38:36.282Z;&quot;Error while connecting to the OPCUA server. Error: The connection may have been rejected by server,Err = (premature socket termination socket timeout : timeout=60000  ClientTCP_transport57)&quot;;error</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2024-01-23T11:38:36.282Z;&quot;South connector &quot;&quot;OPCUA&quot;&quot; (keOidHvw9qJ3CXAr1_zIF) disconnected&quot;;debug</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2024-01-23T11:38:36.282Z;&quot;Error while connecting to the OPCUA server. Error: The connection may have been rejected by server,Err = (premature socket termination socket timeout : timeout=60000  ClientTCP_transport56)&quot;;error</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2024-01-23T11:38:36.282Z;&quot;South connector &quot;&quot;Prosys HA&quot;&quot; (Mv8o0vr_nyh39-eF01Q2l) disconnected&quot;;debug</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2024-01-23T11:38:40.007Z;Opening ./OIBus/data-folder/logs/logs.db SQLite database;debug</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2024-01-23T11:38:40.007Z;&quot;Sending &quot;&quot;SELECT timestamp, message, level FROM logs WHERE timestamp &gt; @StartTime AND timestamp &lt; @EndTime&quot;&quot; with @StartTime = 2024-01-23T10:38:17.083Z @EndTime = 2024-01-23T10:38:40.006Z&quot;;info</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2024-01-23T11:38:40.059Z;Found 24 results for item SQLite log 2 in 52 ms;info</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2024-01-23T11:38:40.063Z;&quot;Writing 4913 bytes into CSV file at &quot;&quot;./OIBus/data-folder/cache/data-stream/south-GG6BT_CR31m1h1jMpm9ud/tmp/sqlite-2024_01_23_10_38_40_063.csv&quot;&quot;&quot;;debug</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2024-01-23T11:38:40.063Z;&quot;Sending CSV file &quot;&quot;./OIBus/data-folder/cache/data-stream/south-GG6BT_CR31m1h1jMpm9ud/tmp/sqlite-2024_01_23_10_38_40_063.csv&quot;&quot; to Engine&quot;;debug</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2024-01-23T11:38:40.063Z;&quot;Add file &quot;&quot;./OIBus/data-folder/cache/data-stream/south-GG6BT_CR31m1h1jMpm9ud/tmp/sqlite-2024_01_23_10_38_40_063.csv&quot;&quot; to cache from South &quot;&quot;SQLite log&quot;&quot;&quot;;debug</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2024-01-23T11:38:40.063Z;&quot;Caching file &quot;&quot;./OIBus/data-folder/cache/data-stream/south-GG6BT_CR31m1h1jMpm9ud/tmp/sqlite-2024_01_23_10_38_40_063.csv&quot;&quot; in North connector &quot;&quot;Console debug&quot;&quot;...&quot;;debug</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2024-01-23T11:38:40.064Z;&quot;File &quot;&quot;./OIBus/data-folder/cache/data-stream/south-GG6BT_CR31m1h1jMpm9ud/tmp/sqlite-2024_01_23_10_38_40_063.csv&quot;&quot; cached in &quot;&quot;./OIBus/data-folder/cache/data-stream/north-FSyK0CdXNxVe0onCI1RA1/files/sqlite-2024_01_23_10_38_40_063-1706006320063.csv&quot;&quot;&quot;;debug</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2024-01-23T11:38:40.066Z;Next start time updated from 2024-01-23T10:38:17.083Z to 2024-01-23T10:38:36.282Z;debug</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2024-01-23T11:38:40.067Z;&quot;File &quot;&quot;./OIBus/data-folder/cache/data-stream/north-FSyK0CdXNxVe0onCI1RA1/files/sqlite-2024_01_23_10_38_40_063-1706006320063.csv&quot;&quot; moved to archive folder &quot;&quot;./OIBus/data-folder/cache/data-stream/north-FSyK0CdXNxVe0onCI1RA1/archive/sqlite-2024_01_23_10_38_40_063-1706006320063.csv&quot;&quot;&quot;;debug</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2024-01-23T11:38:46.283Z;Connecting to OPCUA on opc.tcp://oibus.rd.optimistik.fr:53530/OPCUA/SimulationServer;debug</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>In this example, the maximum instant saved for the <code>@StartTime</code> of the next query will be <code>2024-01-23T11:38:46.283Z</code>,
injected into the request in ISO 8601 format.</p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>SQLite log database</div><div class="admonitionContent_BuS1"><p>This query example can be used for the SQLite log database of OIBus <code>./logs/logs.db</code>.</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="north-azure-blob">North Azure Blob<a class="hash-link" aria-label="North Azure Blob的直接链接" title="North Azure Blob的直接链接" href="/zh/docs/use-cases/use-case-mssql#north-azure-blob">​</a></h2>
<p>Be sure to have the user credentials with access to an Azure Blob container with write access.</p>
<p>Create the Azure Blob North connector and populate the relevant fields:</p>
<ul>
<li>Account: <code>oibus</code></li>
<li>Container: <code>test-oibus</code></li>
<li>Path: <code>north-local-oib</code></li>
</ul>
<p>If <strong>Path</strong> is kept empty, the files will be stored at the root container.</p>
<div style="display:flex;justify-content:center;margin-bottom:2rem"><div><p><img decoding="async" loading="lazy" alt="Azure Blob settings" src="/zh/assets/images/azure-blob-settings-e71555e339d132092e3d72ac6f07345c.png" width="1914" height="326" class="img_ev3q"></p></div></div>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>Testing connection</div><div class="admonitionContent_BuS1"><p>You can verify the connection by testing the settings using the <code>Test settings</code> button.</p></div></div></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文件选项卡"><a class="pagination-nav__link pagination-nav__link--prev" href="/zh/docs/use-cases/use-case-opcua"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">使用OIAnalytics的OPCUA</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/zh/docs/use-cases/use-case-ads"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">TwinCAT ADS → OIAnalytics</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a class="table-of-contents__link toc-highlight" href="/zh/docs/use-cases/use-case-mssql#beforehand">Beforehand</a></li><li><a class="table-of-contents__link toc-highlight" href="/zh/docs/use-cases/use-case-mssql#south-mssql">South MSSQL</a><ul><li><a class="table-of-contents__link toc-highlight" href="/zh/docs/use-cases/use-case-mssql#sql-queries">SQL Queries</a></li></ul></li><li><a class="table-of-contents__link toc-highlight" href="/zh/docs/use-cases/use-case-mssql#north-azure-blob">North Azure Blob</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">文件</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/zh/docs/guide/">用户指南</a></li><li class="footer__item"><a class="footer__link-item" href="/zh/docs/developer/">开发人员指南</a></li><li class="footer__item"><a class="footer__link-item" href="/zh/docs/use-cases/">使用案例</a></li></ul></div><div class="col footer__col"><div class="footer__title">社区</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.linkedin.com/showcase/oibus-by-optimistik" target="_blank" rel="noopener noreferrer" class="footer__link-item">LinkedIn<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">更多信息</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/OptimistikSAS/OIBus" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 Optimistik。用 Docusaurus 制作。</div></div></div></footer></div>
</body>
</html>