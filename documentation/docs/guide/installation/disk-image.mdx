---
sidebar_position: 4
---

# Automated OIBus Installation

## Objective

This automated installation procedure enables efficient, large-scale OIBus deployments by combining secure installation with standardized initial configuration.

**Key Benefits:**

- **Scalable deployment** across multiple machines
- **Consistent configurations** from first launch
- **Immediate remote management** via [OIAnalytics](./oianalytics.mdx)
- **Reduced manual effort** and minimized setup errors

Perfect for enterprise environments, industrial implementations, or any scenario requiring multiple OIBus instances with uniform configurations.

## Disk Image Preparation

### Sample Implementation

1. Extract the OIBus installation ZIP to `C:\Program Files\OIBus`
2. Add your installation script to this directory
3. Configure the script to run on startup (only if OIBus isn't already installed)
4. Create a disk image (without OIBus installed) for deployment

Additional curl commands can be added to the installation script for initial setup. Specific configurations will be managed through OIAnalytics.

## Sample Installation Script

```batch
@echo off
:: This script checks if OIBus is already installed. If not, it waits for the network, installs OIBus, waits for the service to start, and registers it.

:: Check if OIBus service is already installed
sc query "OIBus" >nul 2>&1
if %errorlevel% equ 0 (
    echo OIBus service is already installed. Skipping installation.
    goto END
)

:: Wait for the network service to be running
echo Waiting for the network service to start...
:WAIT_FOR_NETWORK
sc query "Dnscache" | find "RUNNING" >nul
if %errorlevel% neq 0 (
    timeout /t 5 >nul
    goto WAIT_FOR_NETWORK
)
echo Network service is running.

:: Set the directory where OIBus data will be stored (optional, if not set, the installation script will prompt)
set OIBUS_DATA_DIR=C:\OIBusData

:: Path to the installation script (assumes it is in the same folder as this script)
set INSTALL_SCRIPT_PATH=%~dp0install_oibus.bat

:: Call the installation script, passing the data directory as a parameter if needed
call "%INSTALL_SCRIPT_PATH%" -c "%OIBUS_DATA_DIR%"

:: Check the error level to see if the installation was successful
if %errorlevel% neq 0 (
    echo Error: OIBus installation failed.
    exit /b %errorlevel%
)

:CHECK_SERVICE_RUNNING
:: Wait for the OIBus service to be running
echo Waiting for OIBus service to start...
:WAIT_FOR_OIBUS
for /f "tokens=3 delims=: " %%H in ('sc query "OIBus" ^| findstr "STATE"') do (
    if /I "%%H" NEQ "RUNNING" (
        timeout /t 5 >nul
        goto WAIT_FOR_OIBUS
    )
)
echo OIBus service is now running.

:: Execute the curl command to create North connector
curl --location 'http://localhost:2223//api/north?duplicate=string' \
--header 'Content-Type: application/json' \
--header 'Accept: application/json' \
--data '{
  "name": "North OIAnalytics",
  "type": "oianalytics",
  "description": "",
  "enabled": true,
  "settings": {
    "useOiaModule": true,
    "timeout": 15000,
    "compress": false
  },
  "caching": {
    "archive": {
      "retentionDuration": 0,
      "enabled": false
    },
    "error": {
      "retentionDuration": 0,
      "retryCount": 3,
      "retryInterval": 5000
    },
    "throttling": {
      "maxNumberOfElements": 10000,
      "maxSize": 0,
      "runMinDelay": 200
    },
    "trigger": {
      "numberOfFiles": 1,
      "numberOfElements": 1,
      "scanModeName": "Every minute",
      "scanModeId": null
    }
  },
  "subscriptions": [],
  "transformers": []
}'

:: Execute the curl command to create South connector
curl --location 'http://localhost:2223//api/south?duplicate=string' \
--header 'Content-Type: application/json' \
--header 'Accept: application/json' \
--data '{
  "name": "Production Data Files",
  "type": "folder-scanner",
  "description": "Scans production data CSV files",
  "enabled": true,
  "settings": {
    "throttling": {
      "maxReadInterval": 2203.313621917009,
      "readDelay": 1249.091912457465,
      "overlap": 204.89678909715536
    },
    "host": "127.0.0.1",
    "port": 502,
    "retryInterval": 10000,
    "slaveId": 1,
    "addressOffset": "modbus",
    "endianness": "big-endian",
    "swapBytesInWords": false,
    "swapWordsInDWords": true
  },
  "items": []
}'

:: Execute the curl command to create a scan mode
curl --location 'http://localhost:2223//api/scan-modes' \
--header 'Content-Type: application/json' \
--header 'Accept: application/json' \
--data '{
  "name": "Daily Backup Scan",
  "description": "Scans for new backup data every day at midnight",
  "cron": "0 0 * * *"
}'

:: Execute the curl command to register OIBus
curl --location 'http://localhost:2223//api/oianalytics/register' \
--header 'Content-Type: application/json' \
--data '{
    "host": "https://instance.oianalytics.com",
    "useProxy": false,
    "proxyUrl": null,
    "proxyUsername": null,
    "proxyPassword": null,
    "acceptUnauthorized": false,
    "commandRefreshInterval": 60,
    "commandRetryInterval": 10,
    "messageRetryInterval": 10,
    "commandPermissions": {
        "setpoint": true,
        "testNorthConnection": true,
        "deleteNorth": true,
        "updateNorth": true,
        "createNorth": true,
        "testSouthItem": true,
        "testSouthConnection": true,
        "createOrUpdateSouthItemsFromCsv": true,
        "deleteSouth": true,
        "updateSouth": true,
        "createSouth": true,
        "testHistorySouthItem": true,
        "testHistorySouthConnection": true,
        "testHistoryNorthConnection": true,
        "createOrUpdateHistoryItemsFromCsv": true,
        "deleteHistoryQuery": true,
        "updateHistoryQuery": true,
        "createHistoryQuery": true,
        "deleteCertificate": true,
        "updateCertificate": true,
        "createCertificate": true,
        "deleteIpFilter": true,
        "updateIpFilter": true,
        "createIpFilter": true,
        "deleteScanMode": true,
        "updateScanMode": true,
        "createScanMode": true,
        "updateRegistrationSettings": true,
        "updateEngineSettings": true,
        "regenerateCipherKeys": true,
        "restartEngine": true,
        "updateVersion": true
    }
}'


if %errorlevel% neq 0 (
    echo Error: Failed to register OIBus.
    exit /b %errorlevel%
)

echo OIBus registration completed successfully.

:END
```

:::info
For a complete list of available endpoints, visit the [API documentation page](../../api/index.mdx).
:::
