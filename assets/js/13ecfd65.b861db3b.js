"use strict";(globalThis.webpackChunkdoc_oibus=globalThis.webpackChunkdoc_oibus||[]).push([[4506],{7372:(e,n,i)=>{i.d(n,{A:()=>t});const t=i.p+"assets/images/OPCHDA-test-communication-0b33e3bc28c02660c109d333216d5dd9.png"},16698:(e,n,i)=>{i.d(n,{A:()=>t});const t=i.p+"assets/images/OPCHDA-access-permissions-e19cde2010f16b0d45ab628cc9e55dcf.png"},20982:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>l,contentTitle:()=>c,default:()=>h,frontMatter:()=>o,metadata:()=>t,toc:()=>r});const t=JSON.parse('{"id":"guide/oibus-agent/opc","title":"OPC Classic\u2122","description":"The OIBus agent can receive the following HTTP calls. The agent runs a local HDA module through an inter-process communication. To run properly, COM/DCOM must be enabled.","source":"@site/docs/guide/oibus-agent/opc.mdx","sourceDirName":"guide/oibus-agent","slug":"/guide/oibus-agent/opc","permalink":"/docs/guide/oibus-agent/opc","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2},"sidebar":"guideSidebar","previous":{"title":"ODBC","permalink":"/docs/guide/oibus-agent/odbc"},"next":{"title":"OLEDB","permalink":"/docs/guide/oibus-agent/oledb"}}');var s=i(74848),a=i(28453);const o={sidebar_position:2},c="OPC Classic\u2122",l={},r=[{value:"HTTP API",id:"http-api",level:2},{value:"Status",id:"status",level:3},{value:"Connection",id:"connection",level:3},{value:"Read",id:"read",level:3},{value:"Disconnection",id:"disconnection",level:3},{value:"COM/DCOM setup",id:"comdcom-setup",level:2},{value:"Background",id:"background",level:3},{value:"COM",id:"com",level:4},{value:"DCOM",id:"dcom",level:4},{value:"OPC",id:"opc",level:4},{value:"Windows settings (client)",id:"windows-settings-client",level:3},{value:"Client machine settings",id:"client-machine-settings",level:4},{value:"Test communication",id:"test-communication",level:4},{value:"Authentication",id:"authentication",level:4},{value:"Firewall configuration",id:"firewall-configuration",level:4},{value:"OPCEnum tool",id:"opcenum-tool",level:4},{value:"RPC unavailable",id:"rpc-unavailable",level:5},{value:"Access denied",id:"access-denied",level:5},{value:"Server settings",id:"server-settings",level:3}];function d(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",header:"header",img:"img",li:"li",p:"p",pre:"pre",ul:"ul",...(0,a.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"opc-classic",children:"OPC Classic\u2122"})}),"\n",(0,s.jsxs)(n.p,{children:["The OIBus agent can receive the following ",(0,s.jsx)(n.a,{href:"#http-api",children:"HTTP calls"}),". The agent runs a local HDA module through an inter-process communication. To run properly, ",(0,s.jsx)(n.a,{href:"#comdcom-setup",children:"COM/DCOM"})," must be enabled."]}),"\n",(0,s.jsx)(n.h2,{id:"http-api",children:"HTTP API"}),"\n",(0,s.jsx)(n.h3,{id:"status",children:"Status"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"curl --location 'http://localhost:2224/api/opc/id/status'\n"})}),"\n",(0,s.jsx)(n.h3,{id:"connection",children:"Connection"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'curl --location --request PUT \'http://localhost:2224/api/opc/id/connect\' \\\n--header \'Content-Type: application/json\' \\\n--data \'{\n    "host": "localhost",\n    "serverName": "Matrikon.OPC.Simulation"\n}\'\n'})}),"\n",(0,s.jsx)(n.h3,{id:"read",children:"Read"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'curl --location --request PUT \'http://localhost:2224/api/opc/id/read\' \\\n--header \'Content-Type: application/json\' \\\n--data \'{\n    "host": "localhost",\n    "serverName": "Matrikon.OPC.Simulation",\n    "startTime": "2023-11-02T15:00:00.000Z",\n    "endTime": "2023-11-02T16:00:00.000Z",\n    "aggregate": "raw",\n    "resampling": "none",\n    "items": [\n        {\n            "name": "Random",\n            "nodeId": "Random.Int1"\n        },\n        {\n            "name": "Triangle Waves",\n            "nodeId": "Triangle Waves.Int1"\n        },\n        {\n            "name": "Saw-toothed Waves",\n            "nodeId": "Saw-toothed Waves.Int1"\n        }\n    ]\n}\'\n'})}),"\n",(0,s.jsx)(n.h3,{id:"disconnection",children:"Disconnection"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"curl --location --request DELETE 'http://localhost:2224/api/opc/id/disconnect'\n"})}),"\n",(0,s.jsx)(n.h2,{id:"comdcom-setup",children:"COM/DCOM setup"}),"\n",(0,s.jsx)(n.h3,{id:"background",children:"Background"}),"\n",(0,s.jsx)(n.h4,{id:"com",children:"COM"}),"\n",(0,s.jsx)(n.p,{children:"COM is the standard protocol for communication between objects located on the same computer but which are part of different programs. The server is the object providing services, such as making data available. The client is an application that uses the services provided by the server."}),"\n",(0,s.jsx)(n.h4,{id:"dcom",children:"DCOM"}),"\n",(0,s.jsx)(n.p,{children:"DCOM represents an expansion of COM functionality to allow access to objects on remote computers. This protocol allows standardized data exchange between applications from industry, administrative offices and manufacturing."}),"\n",(0,s.jsx)(n.h4,{id:"opc",children:"OPC"}),"\n",(0,s.jsx)(n.p,{children:"The OPC client is an application that accesses process data, messages, and archives of an OPC server. An OPC server is a program that provides standard software interface to read or write data."}),"\n",(0,s.jsx)(n.admonition,{title:"DCOM connectivity",type:"info",children:(0,s.jsx)(n.p,{children:"This page gives some hints on how to set up a communication with COM/DCOM to an OPCHDA server. However, in industrial context, it is often the responsibility of the IT team to correctly set the permissions, firewall and Windows configuration."})}),"\n",(0,s.jsx)(n.h3,{id:"windows-settings-client",children:"Windows settings (client)"}),"\n",(0,s.jsx)(n.h4,{id:"client-machine-settings",children:"Client machine settings"}),"\n",(0,s.jsxs)(n.p,{children:["Follow these steps to enable COM/DCOM communications from the client. First, open the Component services, and access the ",(0,s.jsx)(n.em,{children:"Properties"})," of the computer."]}),"\n",(0,s.jsx)("div",{style:{textAlign:"center"},children:(0,s.jsx)(n.img,{alt:"Component Services",src:i(59605).A+"",width:"565",height:"391"})}),"\n",(0,s.jsxs)(n.p,{children:["Be sure to enable ",(0,s.jsx)(n.em,{children:"Distributed COM"})," on this computer (on the ",(0,s.jsx)(n.em,{children:"Default Properties"})," tab)."]}),"\n",(0,s.jsx)("div",{style:{textAlign:"center"},children:(0,s.jsx)(n.img,{alt:"Component Properties",src:i(28184).A+"",width:"400",height:"558"})}),"\n",(0,s.jsxs)(n.p,{children:["On the ",(0,s.jsx)(n.em,{children:"COM Security"})," tab, edit default ",(0,s.jsx)(n.em,{children:"Launch and Activation Permissions"}),"."]}),"\n",(0,s.jsx)("div",{style:{textAlign:"center"},children:(0,s.jsx)(n.img,{alt:"COM Security",src:i(61369).A+"",width:"400",height:"558"})}),"\n",(0,s.jsxs)(n.p,{children:["On the ",(0,s.jsx)(n.em,{children:"Launch and Activation Permissions"})," window, allow the following permissions:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Local Launch"}),"\n",(0,s.jsx)(n.li,{children:"Remote Launch"}),"\n",(0,s.jsx)(n.li,{children:"Local Activation"}),"\n",(0,s.jsx)(n.li,{children:"Remote Activation"}),"\n"]}),"\n",(0,s.jsx)("div",{style:{textAlign:"center"},children:(0,s.jsx)(n.img,{alt:"Access Permissions",src:i(16698).A+"",width:"363",height:"450"})}),"\n",(0,s.jsx)(n.h4,{id:"test-communication",children:"Test communication"}),"\n",(0,s.jsx)(n.p,{children:"DCOM uses port 135 of the HDA server to exchange with the client. To test connectivity:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-powershell",children:"tnc localhost -port 135\n"})}),"\n",(0,s.jsx)("div",{style:{textAlign:"center"},children:(0,s.jsx)(n.img,{alt:"Test DCOM communication",src:i(7372).A+"",width:"503",height:"299"})}),"\n",(0,s.jsx)(n.h4,{id:"authentication",children:"Authentication"}),"\n",(0,s.jsx)(n.p,{children:'An OPCHDA client program will communicate with the DA/HDA server with the IP address or hostname of the server followed by the "progId" of the server. The user must be known on the HDA server.'}),"\n",(0,s.jsx)(n.admonition,{title:"Important",type:"info",children:(0,s.jsxs)(n.p,{children:["The user must be a member of the ",(0,s.jsx)(n.em,{children:"Distributed COM Users"})," group"]})}),"\n",(0,s.jsx)(n.admonition,{title:"Service",type:"tip",children:(0,s.jsx)(n.p,{children:"If the program runs through a service (such as OIBus), configure the service to run as a specific user."})}),"\n",(0,s.jsx)(n.h4,{id:"firewall-configuration",children:"Firewall configuration"}),"\n",(0,s.jsx)(n.p,{children:"Configure the firewall by adding a rule on port 135."}),"\n",(0,s.jsx)("div",{style:{textAlign:"center"},children:(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"Windows Firewall Configuration",src:i(56931).A+"",width:"797",height:"728"})})}),"\n",(0,s.jsx)(n.p,{children:"For cloud hosts like Lightsail, configure additional firewall rules:"}),"\n",(0,s.jsx)("div",{style:{textAlign:"center"},children:(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"Lightsail Firewall Configuration",src:i(94671).A+"",width:"908",height:"442"})})}),"\n",(0,s.jsx)(n.h4,{id:"opcenum-tool",children:"OPCEnum tool"}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.a,{href:"https://opcfoundation.org/developer-tools/samples-and-tools-classic/core-components/",children:"OPCEnum"})," tool allows OPCHDA clients to locate servers on remote nodes."]}),"\n",(0,s.jsx)(n.h5,{id:"rpc-unavailable",children:"RPC unavailable"}),"\n",(0,s.jsx)(n.p,{children:"If the RPC server is unavailable, check your firewall and test communication again."}),"\n",(0,s.jsx)("div",{style:{textAlign:"center"},children:(0,s.jsx)(n.img,{alt:"RPC Unavailable",src:i(56415).A+"",width:"908",height:"214"})}),"\n",(0,s.jsx)(n.h5,{id:"access-denied",children:"Access denied"}),"\n",(0,s.jsx)(n.p,{children:"Check user credentials and group membership if access is denied."}),"\n",(0,s.jsx)("div",{style:{textAlign:"center"},children:(0,s.jsx)(n.img,{alt:"Access denied",src:i(47745).A+"",width:"1370",height:"732"})}),"\n",(0,s.jsx)(n.h3,{id:"server-settings",children:"Server settings"}),"\n",(0,s.jsxs)(n.p,{children:["Check if DCOM is enabled for the OPC Server application in the ",(0,s.jsx)(n.em,{children:"Component Service"})," window."]}),"\n",(0,s.jsx)("div",{style:{textAlign:"center"},children:(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"Server Machine DCOM Configuration",src:i(98035).A+"",width:"692",height:"596"})})})]})}function h(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},28184:(e,n,i)=>{i.d(n,{A:()=>t});const t=i.p+"assets/images/OPCHDA-computer-properties-5bc31d8ef3b156f9b1cc1454724b7fbe.png"},28453:(e,n,i)=>{i.d(n,{R:()=>o,x:()=>c});var t=i(96540);const s={},a=t.createContext(s);function o(e){const n=t.useContext(a);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),t.createElement(a.Provider,{value:n},e.children)}},47745:(e,n,i)=>{i.d(n,{A:()=>t});const t=i.p+"assets/images/OPCHDA-access-denied-8203f722add5f399a9753da6145f9888.png"},56415:(e,n,i)=>{i.d(n,{A:()=>t});const t=i.p+"assets/images/OPCHDA-rpc-unavailable-39f6b46627fd092a7d0199d5eb0578b3.png"},56931:(e,n,i)=>{i.d(n,{A:()=>t});const t=i.p+"assets/images/OPCHDA-windows-firewall-1cd04eaa34533956a9f02968f616378c.png"},59605:(e,n,i)=>{i.d(n,{A:()=>t});const t=i.p+"assets/images/OPCHDA-component-services-05e25952ca374b3aeef941bda4ef3da6.png"},61369:(e,n,i)=>{i.d(n,{A:()=>t});const t=i.p+"assets/images/OPCHDA-COM-security-af8091873cb844f8b4170dee7d91a413.png"},94671:(e,n,i)=>{i.d(n,{A:()=>t});const t=i.p+"assets/images/OPCHDA-lightsail-firewall-56e27e7a446d930e611762f6acc024e2.png"},98035:(e,n,i)=>{i.d(n,{A:()=>t});const t=i.p+"assets/images/OPCHDA-server-DCOM-configuration-c41e23873a51d4c0b0841855e0ebd108.png"}}]);