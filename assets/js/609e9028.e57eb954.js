"use strict";(self.webpackChunkdoc_oibus=self.webpackChunkdoc_oibus||[]).push([[1406],{3937:(e,n,t)=>{t.d(n,{Ay:()=>c,RM:()=>r});var i=t(4848),s=t(8453);const r=[{value:"Throttling settings",id:"throttling-settings",level:3}];function o(e){const n={code:"code",h3:"h3",p:"p",strong:"strong",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h3,{id:"throttling-settings",children:"Throttling settings"}),"\n",(0,i.jsx)(n.p,{children:"For South connectors capable of historical data retrieval, you have the flexibility to request data\nin intervals. These intervals can vary in size, depending on factors such as the chosen scan mode or the presence of\nprolonged network failures."}),"\n",(0,i.jsxs)(n.p,{children:["To handle such scenarios, the throttling settings enable you to divide large intervals into smaller sub-intervals, each\nno longer than the specified ",(0,i.jsx)(n.strong,{children:"Max read interval"})," (in seconds). These sub-intervals are requested with a delay defined\nby the ",(0,i.jsx)(n.strong,{children:"Read delay"})," setting (in milliseconds)."]}),"\n",(0,i.jsxs)(n.p,{children:["In certain situations, adding an overlap to the query can be beneficial. You can achieve this by configuring\nthe ",(0,i.jsx)(n.strong,{children:"overlap"})," field (in milliseconds): it will subtract this specified number of milliseconds from the ",(0,i.jsx)(n.code,{children:"@StartTime"}),"\nvariable of the subsequent query."]})]})}function c(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(o,{...e})}):o(e)}},4835:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>a,default:()=>u,frontMatter:()=>c,metadata:()=>i,toc:()=>l});const i=JSON.parse('{"id":"guide/south-connectors/opcua","title":"OPC UA\u2122","description":"OPC UA\u2122, which stands for OPC Unified Architecture, is a protocol designed for accessing data in both read and write","source":"@site/docs/guide/south-connectors/opcua.mdx","sourceDirName":"guide/south-connectors","slug":"/guide/south-connectors/opcua","permalink":"/docs/guide/south-connectors/opcua","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2},"sidebar":"guideSidebar","previous":{"title":"Folder Scanner","permalink":"/docs/guide/south-connectors/folder-scanner"},"next":{"title":"Microsoft SQL Server\u2122","permalink":"/docs/guide/south-connectors/mssql"}}');var s=t(4848),r=t(8453),o=t(3937);const c={sidebar_position:2},a="OPC UA\u2122",d={},l=[{value:"Specific settings",id:"specific-settings",level:2},...o.RM,{value:"Item settings",id:"item-settings",level:2},{value:"Security settings",id:"security-settings",level:2},{value:"Communication",id:"communication",level:3},{value:"Authentication",id:"authentication",level:3},{value:"Use the same certificate for user authentication and secure communications",id:"use-the-same-certificate-for-user-authentication-and-secure-communications",level:3},{value:"Using certificates with ProSys OPC UA Simulation Server",id:"using-certificates-with-prosys-opc-ua-simulation-server",level:2}];function h(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"opc-ua",children:"OPC UA\u2122"})}),"\n",(0,s.jsxs)(n.p,{children:["OPC UA\u2122, which stands for OPC Unified Architecture, is a protocol designed for accessing data in both read and write\nmodes.\nThe data is organized within a tree-like address space and is referenced using unique identifiers known as node IDs.\nOPC UA is a modern standard that is based on TCP/IP and has replaced older OPC Classic\u2122 (HDA/DA) technologies (refer to\nthe ",(0,s.jsx)(n.a,{href:"/docs/guide/south-connectors/opc",children:"OPC Classic\u2122 connector"}),"). It is often natively embedded in industrial controllers."]}),"\n",(0,s.jsx)(n.p,{children:"OPC UA incorporates two variants of the protocol: HA (Historical Access) and DA (Data Access). In HA mode, you can\naccess a history of values over a specified time interval for the requested data points, whereas in DA mode, you can\naccess the values at each request or listen to changes in the values."}),"\n",(0,s.jsxs)(n.p,{children:["OIBus integrates both OPC UA modes (HA and DA) in read-only mode, using\nthe ",(0,s.jsx)(n.a,{href:"https://github.com/node-opcua/node-opcua",children:"node-opcua library"}),"."]}),"\n",(0,s.jsx)(n.h2,{id:"specific-settings",children:"Specific settings"}),"\n",(0,s.jsx)(n.p,{children:"To establish a connection to an OPC UA server, OIBus requires several settings:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"URL"}),": This is the string used to connect to the server, and it follows the format\n",(0,s.jsx)(n.code,{children:"opc.tcp://<host>:<port>/<server-name>"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Retry interval"})," : The time to wait between reconnection attempts in the event of a connection failure."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Security Mode"})," : Communication can be secured using the security mode and security policy fields. Available\nsecurity modes include: ",(0,s.jsx)(n.em,{children:"None"}),", ",(0,s.jsx)(n.em,{children:"Sign"}),", ",(0,s.jsx)(n.em,{children:"SignAndEncrypt"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Security Policy"})," (Applicable when Security mode is not None): Security policies define the level of security for\ncommunication.\nAvailable security policies include: None, Basic128, Basic192, Basic256, Basic128Rsa15, Basic192Rsa15, Basic256Rsa15,\nBasic256Sha256, Aes128_Sha256_RsaOaep, PubSub_Aes128_CTR, PubSub_Aes256_CTR."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Authentication"}),": Authentication options include None, Basic, and Certificate. Refer to\nthe ",(0,s.jsx)(n.a,{href:"#authentication",children:"security settings"}),"\nfor more details."]}),"\n"]}),"\n",(0,s.jsx)(n.admonition,{title:"Compatibility with the OPC UA server",type:"caution",children:(0,s.jsx)(n.p,{children:"It's essential to choose a security mode and security policy that are supported by the OPC UA server you are connecting\nto. Ensuring compatibility is crucial for a successful connection."})}),"\n",(0,s.jsx)(o.Ay,{}),"\n",(0,s.jsx)(n.h2,{id:"item-settings",children:"Item settings"}),"\n",(0,s.jsx)(n.p,{children:"When configuring each item to retrieve data in JSON payload, you'll need to specify the following specific settings:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Node ID"}),": The Node ID corresponds to the path of the data within the appropriate namespace on the OPC UA server.\nIt's essential to consider the supported node format of the server, which may use either numbers or strings. For\nexample, on Prosys, ",(0,s.jsx)(n.code,{children:"ns=3;i=1001"})," matches ",(0,s.jsx)(n.code,{children:"ns=3;s=Counter"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Mode"}),": You can select either HA (Historical Access) or DA (Data Access) mode, depending on your requirements."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Aggregate"})," (HA mode only): In HA mode, there is an option to aggregate the retrieved values over the requested\ninterval."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Resampling"})," (HA mode only): Similarly, in HA mode, you can choose to resample the retrieved values at the requested\ninterval."]}),"\n"]}),"\n",(0,s.jsx)(n.admonition,{title:"Compatibility with the OPC UA server",type:"caution",children:(0,s.jsxs)(n.p,{children:["It's important to note that not all aggregation and resampling options are supported by OPC UA servers. To avoid\ncompatibility issues, it's recommended to use ",(0,s.jsx)(n.code,{children:"Raw"})," aggregation and ",(0,s.jsx)(n.code,{children:"None"})," resampling whenever possible. Additionally,\nensure that the selected mode (HA or DA) is supported by the server you are connecting to."]})}),"\n",(0,s.jsxs)(n.p,{children:["The name of the item will serve as a reference in JSON payloads, specifically in the ",(0,s.jsx)(n.code,{children:"pointID"})," field for the North\napplication."]}),"\n",(0,s.jsx)(n.h2,{id:"security-settings",children:"Security settings"}),"\n",(0,s.jsx)(n.h3,{id:"communication",children:"Communication"}),"\n",(0,s.jsxs)(n.p,{children:["When using a security mode other than ",(0,s.jsx)(n.em,{children:"None"}),", a certificate is required to sign and potentially encrypt the\ncommunications.\nOIBus generates a self-signed certificate for securing communication with the OPC UA server during startup. You can\nlocate the certificate used by OPC UA in the ",(0,s.jsx)(n.code,{children:"opcua"})," folder of the South cache. This certificate must be trusted by the\nOPC UA server to enable secure communication."]}),"\n",(0,s.jsx)(n.admonition,{title:"Example on Prosys OPC UA Simulation Server",type:"info",children:(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.img,{alt:"Prosys OPC UA Simulation Server Certificates",src:t(1414).A+"",width:"995",height:"627"}),"\nIf the certificate is not trusted by the OPC UA server, you may encounter an error with the message: ",(0,s.jsx)(n.code,{children:"Error: The connection  may have been rejected by the server"}),"."]})}),"\n",(0,s.jsx)(n.h3,{id:"authentication",children:"Authentication"}),"\n",(0,s.jsxs)(n.p,{children:["The certificate used for client authentication must be added to the trusted user certificates list on the OPC UA server.\nIt is managed separately from the self-signed certificate mentioned earlier, which is used for\n",(0,s.jsx)(n.a,{href:"#communication",children:"securing communication"}),"."]}),"\n",(0,s.jsxs)(n.admonition,{title:"Example on Prosys OPC UA Simulation Server",type:"info",children:[(0,s.jsxs)(n.p,{children:["For Prosys OPC UA servers, the certificate used to authenticate OIBus must be placed in the\n",(0,s.jsx)(n.code,{children:".prosysopc\\prosys-opc-ua-simulation-server\\USERS_PKI\\CA\\certs"})," folder. Failure to do so may result in an error with the\nmessage: ",(0,s.jsx)(n.code,{children:"Error: serviceResult = BadIdentityTokenRejected (0x80210000)"}),"."]}),(0,s.jsxs)(n.p,{children:["If a connection has previously been attempted and rejected, you should remove the certificate from the ",(0,s.jsx)(n.strong,{children:"rejected\ncertificates"}),"\nfolder (",(0,s.jsx)(n.code,{children:".prosysopc\\prosys-opc-ua-simulation-server\\USERS_PKI\\CA\\rejected"}),") and move it to the ",(0,s.jsx)(n.strong,{children:"trusted"})," folder\n(",(0,s.jsx)(n.code,{children:".prosysopc\\prosys-opc-ua-simulation-server\\USERS_PKI\\CA\\certs"}),")."]})]}),"\n",(0,s.jsx)(n.h3,{id:"use-the-same-certificate-for-user-authentication-and-secure-communications",children:"Use the same certificate for user authentication and secure communications"}),"\n",(0,s.jsxs)(n.p,{children:["The same certificate can be used for both sign and encrypt operations and for authentication. To do that, the ",(0,s.jsx)(n.code,{children:"cert.pem"}),"\nand ",(0,s.jsx)(n.code,{children:"private.pem"})," file paths must be specified. They are located in the south cache data stream folder (inside the opcua\ndirectory)."]}),"\n",(0,s.jsxs)(n.p,{children:["On the OPC UA server side, the self-signed certificate (",(0,s.jsx)(n.code,{children:"cert.pem"}),") must be copied in the user certificates' folder."]}),"\n",(0,s.jsxs)(n.p,{children:["For example, with Prosys OPC UA Simulation Server: ",(0,s.jsx)(n.code,{children:".prosysopc\\prosys-opc-ua-simulation-server\\USERS_PKI\\CA\\certs"}),"."]}),"\n",(0,s.jsx)(n.h2,{id:"using-certificates-with-prosys-opc-ua-simulation-server",children:"Using certificates with ProSys OPC UA Simulation Server"}),"\n",(0,s.jsxs)(n.p,{children:["You can create your self-signed certificate to authenticate OIBus with the ",(0,s.jsx)(n.strong,{children:"Cert"})," method."]}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Create a cert.conf file:"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:'[ req ]\ndefault_bits = 2048\ndefault_md = sha256\ndistinguished_name = subject\nreq_extensions = req_ext\nx509_extensions = req_ext\nstring_mask = utf8only\nprompt = no\n\n[ req_ext ]\nbasicConstraints = CA:FALSE\nnsCertType = client, server\nkeyUsage = nonRepudiation, digitalSignature, keyEncipherment, dataEncipherment, keyCertSign\nextendedKeyUsage= serverAuth, clientAuth\nnsComment = "OIBus User Cert"\nsubjectKeyIdentifier=hash\nauthorityKeyIdentifier=keyid,issuer\nsubjectAltName = URI:urn:opcua:user:oibus,IP: 127.0.0.1\n\n[ subject ]\ncountryName = FR\nstateOrProvinceName = FR\nlocalityName = Chamb\xe9ry\norganizationName = OI\ncommonName = oibus\n'})}),"\n",(0,s.jsxs)(n.ol,{start:"2",children:["\n",(0,s.jsxs)(n.li,{children:["Create a private key and certificate using the ",(0,s.jsx)(n.code,{children:"cert.conf"}),":"]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"openssl req -new -x509 -keyout oibus.key -out oibus.pem -config cert.conf\n"})}),"\n",(0,s.jsxs)(n.ol,{start:"2",children:["\n",(0,s.jsx)(n.li,{children:"Remove private key passphrase:"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"openssl rsa -in oibus.key -out oibus.key\n"})}),"\n",(0,s.jsxs)(n.ol,{start:"3",children:["\n",(0,s.jsx)(n.li,{children:"Create DER cert for ProSys:"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"openssl x509 -inform PEM -outform DER -in oibus.pem -out oibus.der\n"})}),"\n",(0,s.jsxs)(n.ol,{start:"4",children:["\n",(0,s.jsxs)(n.li,{children:["Copy the DER cert in ProSys USERS_PKI certificate folder: ",(0,s.jsx)(n.code,{children:"prosys-opc-ua-simulation-server\\USERS_PKI\\CA\\certs"})]}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(h,{...e})}):h(e)}},1414:(e,n,t)=>{t.d(n,{A:()=>i});const i=t.p+"assets/images/prosys-opcua-simulation-server-certificates-3aa9f72ae5a03d39b377b01e927c54ba.png"},8453:(e,n,t)=>{t.d(n,{R:()=>o,x:()=>c});var i=t(6540);const s={},r=i.createContext(s);function o(e){const n=i.useContext(r);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),i.createElement(r.Provider,{value:n},e.children)}}}]);