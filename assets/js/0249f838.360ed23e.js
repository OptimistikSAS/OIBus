"use strict";(globalThis.webpackChunkdoc_oibus=globalThis.webpackChunkdoc_oibus||[]).push([[7],{28453:(e,n,i)=>{i.d(n,{R:()=>t,x:()=>d});var s=i(96540);const r={},l=s.createContext(r);function t(e){const n=s.useContext(l);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:t(e.components),s.createElement(l.Provider,{value:n},e.children)}},60935:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>a,contentTitle:()=>d,default:()=>h,frontMatter:()=>t,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"developer/building","title":"Building OIBus","description":"OIBus uses a fork of pkg as its building tool to create platform-specific binaries.","source":"@site/docs/developer/building.md","sourceDirName":"developer","slug":"/developer/building","permalink":"/docs/developer/building","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"displayed_sidebar":"developerSidebar","sidebar_position":2},"sidebar":"developerSidebar","previous":{"title":"OIBus Developer Handbook","permalink":"/docs/developer/"},"next":{"title":"Create a connector","permalink":"/docs/category/create-a-connector"}}');var r=i(74848),l=i(28453);const t={displayed_sidebar:"developerSidebar",sidebar_position:2},d="Building OIBus",a={},c=[{value:"\ud83d\udce6 Building Binaries",id:"-building-binaries",level:2},{value:"Available Build Commands",id:"available-build-commands",level:3},{value:"Build Process Details",id:"build-process-details",level:3},{value:"\ud83d\ude80 Starting the Binary",id:"-starting-the-binary",level:2},{value:"Available Start Commands",id:"available-start-commands",level:3},{value:"Data Folder",id:"data-folder",level:3},{value:"Windows Installer",id:"windows-installer",level:2},{value:"Prerequisites",id:"prerequisites",level:3},{value:"Certificate Setup",id:"certificate-setup",level:3},{value:"1. Create Configuration File",id:"1-create-configuration-file",level:4},{value:"2. Generate Certificate Files",id:"2-generate-certificate-files",level:4},{value:"3. Build the Installer",id:"3-build-the-installer",level:4},{value:"Installer Build Process",id:"installer-build-process",level:3}];function o(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,l.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"building-oibus",children:"Building OIBus"})}),"\n",(0,r.jsxs)(n.p,{children:["OIBus uses a ",(0,r.jsx)(n.a,{href:"https://github.com/yao-pkg/pkg",children:"fork of pkg"})," as its building tool to create platform-specific binaries."]}),"\n",(0,r.jsx)(n.admonition,{title:"pkg Version Note",type:"caution",children:(0,r.jsxs)(n.p,{children:["The original ",(0,r.jsx)(n.code,{children:"pkg"})," is deprecated. OIBus uses a maintained fork that's compatible with modern Node.js versions."]})}),"\n",(0,r.jsx)(n.h2,{id:"-building-binaries",children:"\ud83d\udce6 Building Binaries"}),"\n",(0,r.jsx)(n.h3,{id:"available-build-commands",children:"Available Build Commands"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Command"}),(0,r.jsx)(n.th,{children:"Platform"}),(0,r.jsx)(n.th,{children:"Architecture"}),(0,r.jsx)(n.th,{children:"Description"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"npm run build:win-x64"})}),(0,r.jsx)(n.td,{children:"Windows"}),(0,r.jsx)(n.td,{children:"x64"}),(0,r.jsx)(n.td,{children:"Builds Windows executable"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"npm run build:linux-x64"})}),(0,r.jsx)(n.td,{children:"Linux"}),(0,r.jsx)(n.td,{children:"x64"}),(0,r.jsx)(n.td,{children:"Builds for x64 Linux systems"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"npm run build:linux-arm64"})}),(0,r.jsx)(n.td,{children:"Linux"}),(0,r.jsx)(n.td,{children:"ARM64"}),(0,r.jsx)(n.td,{children:"Builds for ARM64 Linux (Raspberry Pi 3 B+, etc.)"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"npm run build:macos-x64"})}),(0,r.jsx)(n.td,{children:"macOS"}),(0,r.jsx)(n.td,{children:"Intel"}),(0,r.jsx)(n.td,{children:"Builds for Intel-based Macs"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"npm run build:macos-arm64"})}),(0,r.jsx)(n.td,{children:"macOS"}),(0,r.jsx)(n.td,{children:"Apple Silicon"}),(0,r.jsx)(n.td,{children:"Builds for M1/M2 Macs"})]})]})]}),"\n",(0,r.jsx)(n.h3,{id:"build-process-details",children:"Build Process Details"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Prerequisites"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Node.js installed (version specified in ",(0,r.jsx)(n.code,{children:".nvmrc"}),")"]}),"\n",(0,r.jsxs)(n.li,{children:["All dependencies installed (",(0,r.jsx)(n.code,{children:"npm install"}),")"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Building"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Example: Build for Windows\nnpm run build:win\n\n# Output will be in:\n# ./dist/oibus-win-x64/\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Build Output"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Binaries are output to the ",(0,r.jsx)(n.code,{children:"dist/"})," directory"]}),"\n",(0,r.jsx)(n.li,{children:"Each platform has its own subdirectory"}),"\n",(0,r.jsx)(n.li,{children:"Includes all required assets and dependencies"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"-starting-the-binary",children:"\ud83d\ude80 Starting the Binary"}),"\n",(0,r.jsx)(n.h3,{id:"available-start-commands",children:"Available Start Commands"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Command"}),(0,r.jsx)(n.th,{children:"Platform"}),(0,r.jsx)(n.th,{children:"Description"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"npm run start:win-x64"})}),(0,r.jsx)(n.td,{children:"Windows"}),(0,r.jsx)(n.td,{children:"Starts Windows binary"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"npm run start:linux-x64"})}),(0,r.jsx)(n.td,{children:"Linux"}),(0,r.jsx)(n.td,{children:"Starts Linux binary"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"npm run start:linux-arm64"})}),(0,r.jsx)(n.td,{children:"Linux ARM64"}),(0,r.jsx)(n.td,{children:"Starts ARM64 Linux binary"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"npm run start:macos-x64"})}),(0,r.jsx)(n.td,{children:"macOS Intel"}),(0,r.jsx)(n.td,{children:"Starts Intel Mac binary"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"npm run start:macos-arm64"})}),(0,r.jsx)(n.td,{children:"macOS Apple Silicon"}),(0,r.jsx)(n.td,{children:"Starts Apple Silicon binary"})]})]})]}),"\n",(0,r.jsx)(n.h3,{id:"data-folder",children:"Data Folder"}),"\n",(0,r.jsxs)(n.p,{children:["All commands use ",(0,r.jsx)(n.code,{children:"data-folder"})," as the default directory for:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Configuration files"}),"\n",(0,r.jsx)(n.li,{children:"Cache storage"}),"\n",(0,r.jsx)(n.li,{children:"Log files"}),"\n",(0,r.jsx)(n.li,{children:"Temporary data"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"windows-installer",children:"Windows Installer"}),"\n",(0,r.jsxs)(n.p,{children:["The Windows installer is built using ",(0,r.jsx)(n.a,{href:"https://jrsoftware.org/isinfo.php",children:"Inno Setup"}),"."]}),"\n",(0,r.jsx)(n.h3,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Windows operating system"}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"https://jrsoftware.org/isinfo.php",children:"Inno Setup"})," installed"]}),"\n",(0,r.jsx)(n.li,{children:"OpenSSL for certificate operations"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"certificate-setup",children:"Certificate Setup"}),"\n",(0,r.jsx)(n.h4,{id:"1-create-configuration-file",children:"1. Create Configuration File"}),"\n",(0,r.jsxs)(n.p,{children:["Create ",(0,r.jsx)(n.code,{children:"cert.conf"})," with the following content:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ini",children:'[ req ]\ndefault_bits = 2048\ndefault_md = sha256\ndistinguished_name = subject\nreq_extensions = req_ext\nx509_extensions = req_ext\nstring_mask = utf8only\nprompt = no\n\n[ req_ext ]\nbasicConstraints = CA:FALSE\nnsCertType = client, server\nkeyUsage = nonRepudiation, digitalSignature, keyEncipherment, dataEncipherment, keyCertSign\nextendedKeyUsage = serverAuth, clientAuth\nnsComment = "OIBus Cert"\nsubjectKeyIdentifier = hash\nauthorityKeyIdentifier = keyid,issuer\nsubjectAltName = URI:urn:oibus,IP:127.0.0.1\n\n[ subject ]\ncountryName = FR\nstateOrProvinceName = FR\nlocalityName = Chamb\xe9ry\norganizationName = OI\ncommonName = oibus\n'})}),"\n",(0,r.jsx)(n.h4,{id:"2-generate-certificate-files",children:"2. Generate Certificate Files"}),"\n",(0,r.jsxs)(n.p,{children:["Run these commands in ",(0,r.jsx)(n.strong,{children:"PowerShell"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-powershell",children:'# Generate private key and CSR\nopenssl req -new -newkey rsa:4096 -keyout private.key -sha256 -nodes -out oibus.csr -config cert.conf\n\n# Create self-signed certificate\nopenssl x509 -req -in oibus.csr -signkey private.key -out oibus.crt\n\n# Convert to PFX format\nopenssl pkcs12 -export -in oibus.crt -inkey private.key -out oibus.pfx -passout pass:password -name "OIBus"\n\n# Convert to base64\n$pfxContent = [System.Convert]::ToBase64String((Get-Content -Path "oibus.pfx" -Encoding Byte))\n$pfxContent | Out-File -FilePath "oibus64.pfx" -Encoding ASCII\n'})}),"\n",(0,r.jsx)(n.h4,{id:"3-build-the-installer",children:"3. Build the Installer"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-powershell",children:'# Set environment variables\n$env:PFX_PASSWORD = "password"\n$env:PFX_PATH = "full\\path\\to\\oibus64.pfx"\n\n# Run the build\nnpm run build:win-setup\n'})}),"\n",(0,r.jsx)(n.h3,{id:"installer-build-process",children:"Installer Build Process"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"The script:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Compiles the binary (if not already built)"}),"\n",(0,r.jsx)(n.li,{children:"Creates installer configuration"}),"\n",(0,r.jsx)(n.li,{children:"Signs the executable"}),"\n",(0,r.jsxs)(n.li,{children:["Packages everything into an ",(0,r.jsx)(n.code,{children:".exe"})," installer"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Output"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Installer will be in ",(0,r.jsx)(n.code,{children:"dist/setup/"})]}),"\n",(0,r.jsxs)(n.li,{children:["Named ",(0,r.jsx)(n.code,{children:"OIBus-Setup-{version}.exe"})]}),"\n"]}),"\n"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(o,{...e})}):o(e)}}}]);